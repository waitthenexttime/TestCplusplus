[TOC]



# 操作系统

## 参考资料

- [视频:操作系统](https://www.bilibili.com/video/BV1d4411v7u7?p=3&spm_id_from=pageDriver)
- [书籍:现代操作系统](file:///D:/为中华之崛起而读书/计算机书籍/现代操作系统（原书第3版） (计算机科学丛书).pdf)
- [实验:操作系统原理与实践](https://www.lanqiao.cn/courses/115)
- [书籍:王道考研操作系统](file:///D:/为中华之崛起而读书/考研/王道/2021王道操作系统.pdf)

## L1 什么是操作系统？

操作系统管理各种计算机硬件，为应用程序提供基础，并充当计算机硬件与用户之间的中介。

### 实验1

编译好的内核

![image-20210710175827898](https://raw.githubusercontent.com/Casten-Wang/Pic/master/image-20210710175827898.png)

### 实验2

解压linux-0.11

```
tar -zxvf hit-oslab-linux-20110823.tar.gz \
  -C /home/shiyanlou/
```

Ubuntu 上先从终端进入 ~/oslab/linux-0.11/boot/目录

执行下面两个命令编译和链接 bootsect.s：

```
$ as86 -0 -a -o bootsect.o bootsect.s
$ ld86 -0 -s -o bootsect bootsect.o
```

![image-20210711112503976](https://raw.githubusercontent.com/Casten-Wang/Pic/master/20210711112504.png)

其中 bootsect.o 是中间文件。bootsect 是编译、链接后的目标文件。

需要留意的文件是 bootsect 的文件大小是 544 字节，而引导程序必须要正好占用一个磁盘扇区，即 512 个字节。造成多了 32 个字节的原因是 ld86 产生的是 Minix 可执行文件格式，这样的可执行文件处理文本段、数据段等部分以外，还包括一个 Minix 可执行文件头部，它的结构如下：

```c
struct exec {
    unsigned char a_magic[2];  //执行文件魔数
    unsigned char a_flags;
    unsigned char a_cpu;       //CPU标识号
    unsigned char a_hdrlen;    //头部长度，32字节或48字节
    unsigned char a_unused;
    unsigned short a_version;
    long a_text; long a_data; long a_bss; //代码段长度、数据段长度、堆长度
    long a_entry;    //执行入口地址
    long a_total;    //分配的内存总量
    long a_syms;     //符号表大小
};
```

6 char（6 字节）+ 1 short（2 字节） + 6 long（24 字节）= 32，正好是 32 个字节，去掉这 32 个字节后就可以放入引导扇区了。

对于上面的 Minix 可执行文件，其 a_magic[0]=0x01，a_magic[1]=0x03，a_flags=0x10（可执行文件），a_cpu=0x04（表示 Intel i8086/8088，如果是 0x17 则表示 Sun 公司的 SPARC），所以 bootsect 文件的头几个字节应该是 01 03 10 04。为了验证一下，Ubuntu 下用命令“hexdump -C bootsect”可以看到：

![image-20210711114159401](https://raw.githubusercontent.com/Casten-Wang/Pic/master/20210711114159.png)



